[toc]

# IP 网际协议

# 核心概念

* 不可靠
	* 不能保证IP数据报能成功地到达目的地
	* IP仅提供最好的传输服务
	* 发生某种错误时，丢弃该数据报，然后发送ICMP消息报给信源端
* 无连接
	* IP并不维护任何关于后续数据报的状态信息，每个数据报的处理是相互独立的

# IP数据报

![](media/15479676073013.jpg)

* 普通的IP首部长为20个字节，除非含有选项字段
* TCP/IP首部中所有的二进制整数在网络中都以 `big endian` 传输，也称作网络字节序
	* 其他形式存储二进制整数的机器，必须在传输数据之前把首部转换成网络字节序
* 目前的协议版本号是4，也称作IPv4
* 首部长度指的是首部占32 bit字的数目，包括任何选项，由于它是一个4比特字段，因此首部最长为60个字节 WHAT？？？
* TOS 服务类型字段
	* 3 bit 优先权 已忽略
	* 4 bit TOS
		* 最小时延、最大吞吐量、最高可靠性和最小费用 单选
	* 1 bit 未用位 置0
	* 服务类型及推荐值
		![](media/15479685254412.jpg)
* 总长度字段
	* 整个IP数据报的长度，单位字节
	* 字段长16bit，所以IP数据报最长可达65535字节
		* 过长的数据报会被大多数的链路层分片
		* 主机也要求不能接收超过576 bytes的数据报
		* 大量基于UDP的应用（RIP，TFTP，BOOTP，DNS，SNMP）都限制用户数据报长度为512字节，但大多数的实现（特别是那些支持网络文件系统NFS的实现）允许超过8192字节I P数据报。
	* 由于TCP把用户数据分成若干片，因此一般来说这个限制不会影响TCP
	* 总长度字段是必要的内容，因为一些数据链路需要填充一些数据，解析时也能定位数据报内容的位置
* 标识字段
	* 唯一地标识主机发送的每一份数据报
	* 通常每发送一份报文它的值就会加1
* TTL生存时间字段
	* 数据报可以经过的最多路由器数
	* TTL的初始值由源主机设置（通常为32或64），一旦经过一个处理它的路由器，它的值就减去1，值为0时丢弃数据报，并发送ICMP报文通知源主机
* 首部检验和字段
	* 首先把检验和字段置为0，然后对首部中每个16 bit进行二进制反码求和
	* 检验和错误时，IP就丢弃收到的数据报，但不生成差错报文，由上层去发现丢失的数据报并进行重传
* 源IP地址和目的IP地址
	* 各32 bit
* 是任选项字段
	* 变长

# 路由选择

# 子网

# ifconfig和netstat分析IP




